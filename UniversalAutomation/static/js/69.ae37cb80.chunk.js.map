{"version":3,"sources":["components/api/apis.tsx"],"names":["Option","Select","Table","React","lazy","EditModal","DeleteButton","EditorButton","EndpointModal","Apis","useState","tags","setTags","storedView","localStorage","getItem","view","setView","folder","setFolder","currentTheme","useThemeSwitcher","useQuery","enabled","endpoints","data","isLoading","refetch","toEliminateEmpty","node","childrenToRemove","children","filter","m","length","map","key","indexOf","forEach","treeData","regex","title","level","x","url","startsWith","api","split","reduce","r","name","i","a","push","toTreeStructure","configurationResult","columns","dataIndex","width","render","text","row","method","Text","strong","style","color","setMethodColor","toUpperCase","align","responsive","record","environment","path","role","authentication","editable","value","tag","cursor","onClick","find","allowedWithOneWayGitSync","to","id","resource","subTitle","extra","success","error","type","message","description","hasSider","height","backgroundColor","Sider","theme","className","padding","defaultExpandAll","onSelect","keys","toString","Content","actions","closable","onClose","onChange","setItem","suffixIcon","loading","filterEndpoints","endpoint","trimStart","folderMatch","regexMatch","filterApis","queryFn"],"mappings":"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","file":"static/js/69.ae37cb80.chunk.js","sourcesContent":["import React from \"react\";\r\nimport { Alert, Layout, PageHeader, Select, Space, Tag, Typography } from \"antd\";\r\nimport { ConfigurationResult, CustomColumns, Endpoint } from \"../../types\";\r\nimport { setMethodColor } from \"../utils/utils\";\r\nimport { useQuery } from \"react-query3\";\r\nimport { Modal } from \"components/ui/Modal\";\r\nimport { FolderViewOutlined } from \"@ant-design/icons\";\r\nimport { useThemeSwitcher } from \"react-css-theme-switcher\";\r\nimport DirectoryTree from \"antd/lib/tree/DirectoryTree\";\r\nimport { SiderTheme } from \"antd/es/layout/Sider\";\r\nimport DocsButton from \"components/docsButton\";\r\n\r\nconst { Option } = Select;\r\nconst Table = React.lazy(() => import(\"components/ui/Table\"));\r\nconst EditModal = React.lazy(() => import(\"components/ui/EditModal\"));\r\nconst DeleteButton = React.lazy(() => import(\"components/ui/DeleteButton\"));\r\nconst EditorButton = React.lazy(() => import(\"components/ui/EditorButton\"));\r\nconst EndpointModal = React.lazy(() => import(\"./EndpointModal\"));\r\n\r\nexport default function Apis() {\r\n  const [tags, setTags] = React.useState([]);\r\n  const storedView = localStorage.getItem('api-view');\r\n  const [view, setView] = React.useState(storedView || 'folder');\r\n  const [folder, setFolder] = React.useState('');\r\n  const { currentTheme } = useThemeSwitcher();\r\n\r\n  const { data: endpoints, isLoading, refetch } = useQuery<Endpoint[]>(\r\n    \"/endpoint\",\r\n    { enabled: false }\r\n  );\r\n\r\n  const toEliminateEmpty = (node) => {\r\n    const childrenToRemove = node.children.filter(m => m.children.length === 0).map(m => m.key);\r\n    node.children = node.children.filter(m => childrenToRemove.indexOf(m.key) === -1);\r\n    node.children.forEach(m => toEliminateEmpty(m));\r\n\r\n    return node;\r\n  }\r\n\r\n  const toTreeStructure = () => {\r\n    let regex = { title: 'RegEx', key: 'RegEx', children: [] }\r\n    let level = { title: 'Endpoints', key: '', children: [regex], regex };\r\n\r\n    endpoints?.filter(x => !x.url.startsWith('^\\\\')).forEach(api => {\r\n      api.url.split('/').filter(x => x !== \"\").reduce((r, name, i, a) => {\r\n        name = \"/\" + name\r\n        if (!r[name]) {\r\n          r[name] = { children: [] };\r\n          r.children.push({ title: name, key: api.url, children: r[name].children })\r\n        }\r\n        return r[name];\r\n      }, level)\r\n    })\r\n\r\n    endpoints?.filter(x => x.url.startsWith('^\\\\')).forEach(api => {\r\n      regex.children.push({ title: api.url, key: api.url, children: [] })\r\n    })\r\n\r\n    return [toEliminateEmpty(level)];\r\n  }\r\n\r\n  const treeData = toTreeStructure();\r\n  const { data: configurationResult } = useQuery<ConfigurationResult>(\r\n    \"/configuration/status/Endpoint\"\r\n  );\r\n\r\n  const columns: CustomColumns<Endpoint>[] = [\r\n    {\r\n      key: \"method\",\r\n      title: \"Method\",\r\n      dataIndex: \"method\",\r\n      width: \"5%\",\r\n      render: (text, row: Endpoint) => {\r\n        return (\r\n          <Typography>\r\n            <Space>\r\n              {row.method?.map(x => <>\r\n                <Typography.Text\r\n                  strong\r\n                  style={{ color: setMethodColor(x) }}\r\n                >\r\n                  {x.toUpperCase()}\r\n                </Typography.Text>\r\n              </>)}\r\n            </Space>\r\n          </Typography>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      key: \"url\",\r\n      title: \"Url\",\r\n      dataIndex: \"url\",\r\n    },\r\n    {\r\n      key: \"environment\",\r\n      title: \"Environment\",\r\n      dataIndex: \"environment\",\r\n      width: \"min-content\",\r\n      align: \"center\",\r\n      responsive: [\"xl\"],\r\n      render: (text, record) =>\r\n        record?.environment === null ? \"Default\" : record?.environment,\r\n    },\r\n    {\r\n      key: \"description\",\r\n      title: \"Description\",\r\n      dataIndex: \"description\",\r\n    },\r\n    {\r\n      key: \"path\",\r\n      title: \"Path\",\r\n      dataIndex: \"path\",\r\n      render: (text, record) => record?.path || \"endpoints.ps1\",\r\n      responsive: [\"xl\"],\r\n    },\r\n    {\r\n      key: \"role\",\r\n      title: \"Role\",\r\n      dataIndex: \"role\",\r\n      responsive: [\"xl\"],\r\n      render: (text, record) =>\r\n        record?.role?.map((role) => (\r\n          <Tag key={role} color=\"blue\">\r\n            {role}\r\n          </Tag>\r\n        ))\r\n    },\r\n    {\r\n      key: \"authentication\",\r\n      title: \"Authentication\",\r\n      dataIndex: \"authentication\",\r\n      align: \"center\",\r\n      responsive: [\"xl\"],\r\n      render: (text, record) =>\r\n        record?.authentication ? \"Enabled\" : \"Disabled\",\r\n    },\r\n    {\r\n      key: \"tags\",\r\n      title: \"Tags\",\r\n      dataIndex: \"tags\",\r\n      editable: false,\r\n      render: (value, record: Endpoint) => {\r\n        return record.tag?.length > 0\r\n          ? record?.tag?.map((tag) => (\r\n            <Tag key={tag?.name} color={tag?.color} style={{ cursor: 'pointer' }} onClick={() => {\r\n              if (!tags.find(m => m.name === tag.name)) {\r\n                setTags([...tags, tag]);\r\n              }\r\n            }}>\r\n              {tag?.name}\r\n            </Tag>\r\n          ))\r\n          : null;\r\n      },\r\n      responsive: [\"xl\"],\r\n    },\r\n    {\r\n      width: \"fit-content\",\r\n      dataIndex: \"actions\",\r\n      render: (text, record) => {\r\n        return (\r\n          <Space>\r\n            <Modal>\r\n              <EditModal record={record} allowedWithOneWayGitSync={false} />\r\n            </Modal>\r\n            {record?.path === null && <EditorButton to={`${record?.id}`} allowedWithOneWayGitSync={false} />}\r\n            <DeleteButton resource={record} allowedWithOneWayGitSync={false} />\r\n          </Space>\r\n        );\r\n      },\r\n    },\r\n  ];\r\n\r\n  const changeView = (view: string) => {\r\n    localStorage.setItem('api-view', view);\r\n    setView(view);\r\n  }\r\n\r\n  const filterTags = () => {\r\n    return endpoints?.filter((endpoint) => tags.length === 0 || (endpoint.tag && endpoint.tag?.find(m => tags.find(tag => tag.name === m.name))));\r\n  }\r\n\r\n  const filterApis = () => {\r\n    const filterEndpoints = filterTags();\r\n\r\n    const folderMatch = (endpoint) => {\r\n      if (folder === '' && treeData[0].children.filter(m => endpoint.url.startsWith(m.key)).length === 0) {\r\n        return true;\r\n      }\r\n      return (folder !== '' && endpoint.url.startsWith(folder)) || (folder === '' && endpoint.url.trimStart('/').indexOf('/') === -1)\r\n    }\r\n\r\n    const regexMatch = (endpoint) => {\r\n      return (folder === 'RegEx' && endpoint.url.startsWith('^\\\\'));\r\n    }\r\n\r\n    return filterEndpoints?.filter(endpoint => view === 'list' || folderMatch(endpoint) || regexMatch(endpoint));\r\n  }\r\n\r\n  return (\r\n    <PageHeader title=\"Endpoints\" subTitle=\"HTTP API endpoints that execute PowerShell Scripts.\" extra={[\r\n      <DocsButton url=\"api/about\" />\r\n    ]}>\r\n      {configurationResult?.success === false && configurationResult?.error ? <Alert type=\"error\" message={\"These is an error with the configuration script for this page. You will need to correct the issue manually before continuing. \"} description={configurationResult?.error}></Alert> :\r\n        <Layout hasSider={treeData?.length > 0 && view === 'folder'} style={{ height: '100%', backgroundColor: currentTheme === \"dark\" ? \"#141414\" : \"white\" }}>\r\n          {treeData?.length > 0 && view === 'folder' && (<Layout.Sider theme={currentTheme as SiderTheme}>\r\n            <div style={{ width: '100%' }}>\r\n\r\n              <div className=\"ant-table-title\" style={{ backgroundColor: currentTheme === \"dark\" ? \"#141414\" : \"white\", width: '100%', height: '64px', padding: '20px' }}>\r\n                <Typography>Folders</Typography>\r\n              </div>\r\n              <div style={{ height: '54px', backgroundColor: currentTheme === \"dark\" ? \"#1d1d1d\" : \"#fafafa\" }}></div>\r\n              <DirectoryTree defaultExpandAll treeData={treeData} onSelect={(keys) => setFolder(keys[0].toString())} style={{ height: '100%' }} />\r\n            </div>\r\n          </Layout.Sider>)\r\n          }\r\n          < Layout.Content >\r\n            <Table\r\n              title=\"Endpoints\"\r\n              actions={[\r\n                tags.map(tag => {\r\n                  return (\r\n                    <Tag color={tag.color}\r\n                      closable\r\n                      onClose={() => {\r\n                        setTags(tags.filter(m => m.name !== tag.name));\r\n                      }}>{tag.name}</Tag>\r\n                  )\r\n                }),\r\n                <Modal>\r\n                  <EndpointModal />\r\n                </Modal>,\r\n                <Select value={view} onChange={changeView} suffixIcon={<FolderViewOutlined />} key=\"view-select\">\r\n                  <Option value=\"folder\">Folder</Option>\r\n                  <Option value=\"list\">List</Option>\r\n                </Select>\r\n              ]}\r\n              columns={columns}\r\n              loading={isLoading}\r\n              data={filterApis()}\r\n              queryFn={refetch}\r\n            />\r\n          </Layout.Content>\r\n        </Layout>}\r\n    </PageHeader>\r\n\r\n  );\r\n}\r\n"],"sourceRoot":""}