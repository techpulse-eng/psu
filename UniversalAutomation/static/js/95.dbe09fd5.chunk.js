(this["webpackJsonppowershelluniversal.adminconsole"]=this["webpackJsonppowershelluniversal.adminconsole"]||[]).push([[95],{1452:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return L}));var a=n(49),l=n.n(a),i=n(74),c=n(68),o=n(84),r=n(12),s=n(27),u=(n(698),n(0)),d=n(43),j=n(415),b=n(449),h=n(450),O=n(954),p=n(70),m=n(961),f=n(452),x=n(414),v=n(259),y=n(272),g=n(952),S=n(693),w=n(335),C=n(575),k=n(925),A=n(926),P=n(3);function T(e){var t=e.onSubmit,n=e.action,a=Object(u.useState)(!1),l=Object(s.a)(a,2),i=l[0],c=l[1],o=Object(u.useState)(null===n||void 0===n?void 0:n.type),d=Object(s.a)(o,2),j=d[0],b=d[1],O=k.a.useForm(),m=Object(s.a)(O,1)[0],f="Add Action";null!==n&&(f="Edit Action");var v={};return n&&n.settings.forEach((function(e){v[e.name]=e.value})),Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(p.a,{icon:null!==n?Object(P.jsx)(w.a,{}):Object(P.jsx)(C.a,{}),style:{float:"right",marginBottom:"10px"},onClick:function(){return c(!0)},children:f}),Object(P.jsx)(A.a,{title:f,visible:i,onOk:function(){m.validateFields().then((function(e){m.resetFields();var n={name:e.name,type:e.type,settings:[]};Object.keys(e).forEach((function(t){n.settings.push({name:t,value:e[t]})})),t(n),c(!1)})).catch((function(e){h.b.error(e)}))},onCancel:function(){return c(!1)},width:"50%",children:Object(P.jsxs)(k.a,{labelAlign:"left",labelCol:{span:4},wrapperCol:{span:14},form:m,name:"form_in_modal",initialValues:Object(r.a)(Object(r.a)({},n),v),children:[Object(P.jsx)(k.a.Item,{name:"name",label:"Name",help:"Select a name for this action. It will be used when referencing it in rules.",rules:[{required:!0,message:"Please input the name of the rule!"}],children:Object(P.jsx)(S.default,{})}),Object(P.jsx)(k.a.Item,{name:"type",label:"Type",help:"Select the type of action to take.",rules:[{required:!0,message:"Please input the type of the rule!"}],children:Object(P.jsxs)(y.default,{onChange:function(e){return b(e.toString())},children:[Object(P.jsx)(y.default.Option,{value:"block",children:"Block"}),Object(P.jsx)(y.default.Option,{value:"eventLog",children:"Send to Event Log"}),Object(P.jsx)(y.default.Option,{value:"file",children:"Send to File"}),Object(P.jsx)(y.default.Option,{value:"http",children:"Send over HTTP"}),Object(P.jsx)(y.default.Option,{value:"tcp",children:"Send over TCP"}),Object(P.jsx)(y.default.Option,{value:"udp",children:"Send over UDP"}),Object(P.jsx)(y.default.Option,{value:"universal",children:"Send to PowerShell Universal"})]})}),"http"===j&&Object(P.jsx)(k.a.Item,{name:"address",label:"Address",help:"The HTTP address to send the event to.",rules:[{required:!0}],children:Object(P.jsx)(S.default,{})}),"file"===j&&Object(P.jsx)(k.a.Item,{name:"path",label:"Path",help:"The path to write the events to.",rules:[{required:!0}],children:Object(P.jsx)(S.default,{})}),"eventLog"===j&&Object(P.jsx)(k.a.Item,{name:"entryType",label:"Entry Type",help:"The event log entry type.",rules:[{required:!0}],children:Object(P.jsxs)(y.default,{children:[Object(P.jsx)(y.default.Option,{value:"Error",children:"Error"}),Object(P.jsx)(y.default.Option,{value:"FailureAudit",children:"Failure Audit"}),Object(P.jsx)(y.default.Option,{value:"Information",children:"Information"}),Object(P.jsx)(y.default.Option,{value:"SuccessAudit",children:"Success Audit"}),Object(P.jsx)(y.default.Option,{value:"Warning",children:"Warning"})]})}),("tcp"===j||"udp"===j)&&Object(P.jsx)(k.a.Item,{name:"hostname",label:"Host Name",help:"The host name of the machine to send the events to.",rules:[{required:!0}],children:Object(P.jsx)(S.default,{})}),("tcp"===j||"udp"===j)&&Object(P.jsx)(k.a.Item,{name:"port",label:"Port",help:"The port to send the events to.",rules:[{required:!0}],children:Object(P.jsx)(S.default,{type:"number",min:0,max:65556})}),"universal"===j&&Object(P.jsx)(k.a.Item,{name:"address",label:"Address",help:"The HTTP address of the PowerShell Universal server.",rules:[{required:!0}],children:Object(P.jsx)(S.default,{})}),"universal"===j&&Object(P.jsx)(k.a.Item,{name:"appToken",label:"App Token",help:"An app token used to authenticate against PowerShell Universal.",rules:[{required:!0}],children:Object(P.jsx)(S.default,{})}),-1!==["http","eventLog","file","tcp","udp"].indexOf(j)&&Object(P.jsx)(k.a.Item,{name:"format",label:"Format",rules:[{required:!0}],help:Object(P.jsxs)(x.a.Text,{type:"secondary",children:["The ",Object(P.jsx)("a",{href:"https://docs.poshtools.com/powershell-pro-tools-documentation/powershell-protect/actions#formatting-strings",target:"_blank",rel:"noreferrer",children:"format"})," of the message to send"]}),children:Object(P.jsx)(S.default,{type:"textarea"})})]})})]})}var I=n(599);function N(e){var t=e.onSubmit,n=e.actions,a=e.rule,l=Object(u.useState)(!1),i=Object(s.a)(l,2),o=i[0],r=i[1],d=Object(u.useState)((null===a||void 0===a?void 0:a.conditions)||[]),j=Object(s.a)(d,2),b=j[0],O=j[1],m=Object(u.useState)((null===a||void 0===a?void 0:a.actions)||[]),k=Object(s.a)(m,2),T=k[0],N=k[1],E=Object(u.useState)(null===a||void 0===a?void 0:a.name),D=Object(s.a)(E,2),q=D[0],B=D[1],L=Object(u.useState)(null===a||void 0===a?void 0:a.anyCondition),W=Object(s.a)(L,2),H=W[0],M=W[1],F=Object(u.useState)(""),R=Object(s.a)(F,2),J=R[0],V=R[1],_=Object(u.useState)(""),K=Object(s.a)(_,2),U=K[0],z=K[1],Q=Object(u.useState)(""),G=Object(s.a)(Q,2),X=G[0],Y=G[1],Z="Add Rule";null!==a&&(Z="Edit Rule");return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(p.a,{icon:null!==a?Object(P.jsx)(w.a,{}):Object(P.jsx)(C.a,{}),style:{float:"right",marginBottom:"10px"},onClick:function(){return r(!0)},children:Z}),Object(P.jsx)(A.a,{title:Z,visible:o,onOk:function(){q&&""!==q?(t({name:q,anyCondition:H,actions:T,conditions:b}),r(!1),B(""),N([]),O([])):h.b.error("Name is required")},onCancel:function(){return r(!1)},width:"50%",closable:!1,maskClosable:!1,children:Object(P.jsxs)(f.b,{direction:"vertical",style:{width:"100%"},children:[Object(P.jsx)(x.a,{children:"Name"}),Object(P.jsx)(S.default,{value:q,onChange:function(e){return B(e.target.value)}}),Object(P.jsx)(v.default,{checked:H,onChange:function(e){return M(e.target.checked)},children:"Any Condition"}),Object(P.jsx)(x.a.Text,{type:"secondary",children:"When checked, this rule will trigger when any condition is met."}),Object(P.jsx)(x.a,{children:"Conditions"}),Object(P.jsx)(x.a.Text,{type:"secondary",children:"The conditions that need to match for this rule to trigger. By default, all conditions must be met in order for the actions to trigger."}),Object(P.jsxs)(f.b,{direction:"horizontal",style:{width:"100%"},children:[Object(P.jsxs)(y.default,{placeholder:"Select field...",dropdownMatchSelectWidth:!1,onChange:function(e){return V(e.toString())},value:J,children:[Object(P.jsx)(y.default.Option,{value:"admin",children:"Administrator"}),Object(P.jsx)(y.default.Option,{value:"ApplicationName",children:"Application Name"}),Object(P.jsx)(y.default.Option,{value:"ApplicationHash",children:"Application Hash"}),Object(P.jsx)(y.default.Option,{value:"Assembly",children:"Assembly Name"}),Object(P.jsx)(y.default.Option,{value:"AssemblyHash",children:"Assembly Hash"}),Object(P.jsx)(y.default.Option,{value:"Command",children:"Command"}),Object(P.jsx)(y.default.Option,{value:"computername",children:"Computer Name"}),Object(P.jsx)(y.default.Option,{value:"contentpath",children:"Content Path"}),Object(P.jsx)(y.default.Option,{value:"domain",children:"Domain"}),Object(P.jsx)(y.default.Option,{value:"domaincontroller",children:"Domain Controller"}),Object(P.jsx)(y.default.Option,{value:"member",children:"Member"}),Object(P.jsx)(y.default.Option,{value:"script",children:"Script Content"}),Object(P.jsx)(y.default.Option,{value:"string",children:"Strings"}),Object(P.jsx)(y.default.Option,{value:"variables",children:"Variables"})]}),Object(P.jsxs)(y.default,{placeholder:"Select a condition...",dropdownMatchSelectWidth:!1,onChange:function(e){return z(e.toString())},value:U,children:[Object(P.jsx)(y.default.Option,{value:"startswith",children:"Starts With"}),Object(P.jsx)(y.default.Option,{value:"notstartswith",children:"Does Not Start With"}),Object(P.jsx)(y.default.Option,{value:"endswith",children:"Ends With"}),Object(P.jsx)(y.default.Option,{value:"notendswith",children:"Does Not End With"}),Object(P.jsx)(y.default.Option,{value:"equals",children:"Equals"}),Object(P.jsx)(y.default.Option,{value:"notequals",children:"Does Not Equal"}),Object(P.jsx)(y.default.Option,{value:"contains",children:"Contains"}),Object(P.jsx)(y.default.Option,{value:"notcontains",children:"Does Not Contain"}),Object(P.jsx)(y.default.Option,{value:"matches",children:"Matches RegEx"})]}),Object(P.jsx)(S.default,{placeholder:"Enter value...",onChange:function(e){return Y(e.target.value)},value:X}),Object(P.jsx)(p.a,{icon:Object(P.jsx)(I.a,{}),onClick:function(){X&&""!==X?U&&""!==U?(O([].concat(Object(c.a)(b),[{property:J,operator:U,value:X}])),z("equals"),Y("")):h.b.error("Operator is required"):h.b.error("Value is required")}})]}),Object(P.jsx)(g.a,{dataSource:b,columns:[{dataIndex:"property",title:"Property"},{dataIndex:"operator",title:"Operator"},{dataIndex:"value",title:"Value"}]}),Object(P.jsx)(x.a,{children:"Actions"}),Object(P.jsx)(x.a.Text,{type:"secondary",children:"The actions to execute when this rule is matched."}),Object(P.jsx)(y.default,{mode:"multiple",style:{width:"100%"},onChange:function(e){N(e.map((function(e){return{name:e}})))},value:T.map((function(e){return e.name})),children:n.map((function(e){return Object(P.jsx)(y.default.Option,{value:e,children:e})}))})]})})]})}var E=n(443),D=n(22),q=b.a.TabPane,B=[{name:"amsiBypass",displayName:"AMSI Bypass Detection"},{name:"InvokeExpression",displayName:"Disable use of Invoke-Expression"},{name:"ReflectionEmit",displayName:"Disable use of the System.Reflection.Emit Namespace"},{name:"MarshalClass",displayName:"Disable use of the Marshal Class"},{name:"Log4J",displayName:"Log4J CVE-2021-44228 (Log4Shell) Detection"},{name:"loggingBypass",displayName:"Module and Script Block Logging Bypass Protection"},{name:"AssemblyLoad",displayName:"Prevent Assembly Load from Memory"},{name:"BloudHound",displayName:"Prevent BloodHound Injestor Execution"},{name:"PersistentWmi",displayName:"Prevent Creation of Persistent WMI Event Subscriptions"},{name:"DisableDefender",displayName:"Prevent Disabling Defender"},{name:"Kerberoasting",displayName:"Prevent Kerberoasting"},{name:"PowerSploit",displayName:"Prevent the use of PowerSploit"}];function L(){var e=Object(d.i)().id,t=Object(j.a)("/protect/config/".concat(e)),n=t.data,a=t.isLoading,w=Object(u.useState)([]),C=Object(s.a)(w,2),k=C[0],A=C[1],I=Object(u.useState)([]),L=Object(s.a)(I,2),W=L[0],H=L[1],M=Object(u.useState)(""),F=Object(s.a)(M,2),R=F[0],J=F[1],V=Object(D.b)().mutateAsync,_=Object(d.h)(),K=Object(u.useState)(!1),U=Object(s.a)(K,2),z=U[0],Q=U[1],G=Object(u.useState)([]),X=Object(s.a)(G,2),Y=X[0],Z=X[1],$=Object(u.useState)({amsiBypass:!0,InvokeExpression:!0,ReflectionEmit:!0,MarshalClass:!0,Log4J:!0,loggingBypass:!0,AssemblyLoad:!0,BloudHound:!0,PersistentWmi:!0,DisableDefender:!0,Kerberoasting:!0,PowerSploit:!0}),ee=Object(s.a)($,2),te=ee[0],ne=ee[1];function ae(){return(ae=Object(o.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Q(!0),e.next=3,V(Object(r.a)(Object(r.a)({key:null===n||void 0===n||null===(t=n.resourceInfo)||void 0===t?void 0:t.self,action:"update"},n),{},{actions:k,rules:W,license:R,builtIn:{actions:Y,disabledConditions:Object.keys(te).filter((function(e){return!te[e]})),enabled:!0}}),{onSuccess:function(e,t){t.key,t.action;var n=Object(i.a)(t,["key","action"]);Q(!1),h.b.success("Configuration saved"),D.a.refetchQueries("/protect/config/".concat(null===n||void 0===n?void 0:n.id),{exact:!0,stale:!0}),_("/admin/security/protect")}});case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var le=function(e){var t=k.filter((function(t){return t.name!==e.name}));A([].concat(Object(c.a)(t),[e]))},ie=function(e){var t=W.filter((function(t){return t.name!==e.name}));H([].concat(Object(c.a)(t),[e]))};Object(u.useEffect)((function(){if(!a){A(n.actions),H(n.rules),Z(n.builtIn.actions),J(n.license);var e=Object(r.a)({},te);n.builtIn.disabledConditions.forEach((function(t){e[t]=!1})),ne(e)}}),[n,a,ne]);return Object(P.jsx)(O.a,{title:null===n||void 0===n?void 0:n.name,subTitle:null===n||void 0===n?void 0:n.description,extra:[Object(P.jsx)(p.a,{icon:Object(P.jsx)(E.a,{}),type:"primary",onClick:function(){return function(){return ae.apply(this,arguments)}()},loading:z,children:"Save"})],children:Object(P.jsx)(m.a,{children:Object(P.jsxs)(b.a,{defaultActiveKey:"1",children:[Object(P.jsx)(q,{tab:"Default Rules",children:Object(P.jsxs)(f.b,{direction:"vertical",children:[Object(P.jsx)(x.a,{children:"Default Rules"}),Object(P.jsxs)(x.a.Text,{type:"secondary",children:["Enable or disable default rules below. Learn more about the default rules on the ",Object(P.jsx)("a",{target:"_blank",href:"https://docs.poshtools.com/powershell-pro-tools-documentation/powershell-protect/rules#default-rules",rel:"noreferrer",children:"PowerShell Protect documentation"}),"."]}),B.map((function(e){return Object(P.jsx)(v.default,{checked:te[e.name],onChange:function(t){return function(e,t){var n=Object(r.a)({},te);n[e]=t,ne(n)}(e.name,t.target.checked)},children:e.displayName})})),Object(P.jsx)(x.a,{children:"Additional Actions"}),Object(P.jsx)(x.a.Text,{type:"secondary",children:"The additional actions to execute when one of the default rules is matched."}),Object(P.jsx)(y.default,{mode:"multiple",style:{width:"100%"},onChange:function(e){Z(e.map((function(e){return{name:e}})))},value:Y.map((function(e){return e.name})),children:k.map((function(e){return Object(P.jsx)(y.default.Option,{value:e.name,children:e.name})}))})]})},"1"),Object(P.jsxs)(q,{tab:"Custom Rules",children:[Object(P.jsx)(x.a,{style:{float:"left",marginBottom:"10px"},children:"Custom rules contain configurable conditions and actions."}),Object(P.jsx)(N,{onSubmit:function(e){H([].concat(Object(c.a)(W),[e]))},rule:null,actions:k.map((function(e){return e.name}))}),Object(P.jsx)(g.a,{dataSource:W,columns:[{key:"name",title:"Name",dataIndex:"name"},{key:"actions",render:function(e,t){return Object(P.jsx)(N,{onSubmit:ie,rule:t,actions:k.map((function(e){return e.name}))})}}]})]},"2"),Object(P.jsxs)(q,{tab:"Actions",children:[Object(P.jsx)(x.a,{style:{float:"left",marginBottom:"10px"},children:"Actions that can be assigned to rules."}),Object(P.jsx)(T,{onSubmit:function(e){A([].concat(Object(c.a)(k),[e]))},action:null}),Object(P.jsx)(g.a,{dataSource:k,columns:[{key:"name",title:"Name",dataIndex:"name"},{key:"type",title:"Type",dataIndex:"type"},{key:"actions",render:function(e,t){return Object(P.jsx)(T,{onSubmit:le,action:t})}}]})]},"3"),Object(P.jsxs)(q,{tab:"License",children:[Object(P.jsxs)(x.a,{style:{float:"left",marginBottom:"10px"},children:["PowerShell Protect requires a ",Object(P.jsx)("a",{href:"https://ironmansoftware.com/pricing/powershell-pro-tools",target:"_blank",rel:"noreferrer",children:"PowerShell Pro Tools"})," license."]}),Object(P.jsx)(S.default,{type:"textarea",value:R,onChange:function(e){return J(e.target.value)}})]},"4")]})})})}}}]);
//# sourceMappingURL=95.dbe09fd5.chunk.js.map